kind: Run
name: build-hello-fn
type: exec
include: [./index.js]
spec:
  command: [./build.sh]

---
kind: Deploy
name: hello-fn
type: terraform

source:
  path: ../

include: [./terraform/hello-fn, ./terraform/modules/lambda]
dependencies:
  - run.build-hello-fn
  - deploy.dynamodb

spec:
  autoApply: true
  allowDestroy: true
  root: ./terraform/hello-fn
  backendConfig:
    $merge: ${var.backendConfig}
    key: "tf-state/hello-fn/${var.namespaceName}/terraform.tfstate"

  variables:
    zip_version: ${actions.run.build-hello-fn.version}
    function_name: "${var.namespaceName}-hello-fn"
    environment_name: ${environment.name}
    db_host: ${actions.deploy.dynamodb.outputs.db_host}
