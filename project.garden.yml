apiVersion: "garden.io/v1"
kind: Project
name: terraform-lambda-example
defaultEnvironment: dev
dotIgnoreFile: .gitignore

# Replace this with your project ID and Garden Cloud/Enterprise domain
id: 57c1acfd-82c6-48e9-b086-65f42c0e898a
domain: https://example.app.garden

variables:
  # Replace this with your own backen config. In this project we assume the S3 bucket already exists.
  backendConfig:
    bucket: terraform-state-for-dev-testing
    region: eu-central-1

environments:
  - name: dev
    variables:
      namespaceName: dev-${kebabCase(local.username)}
      helloFnName: ${var.namespaceName}-hello-fn
      goodbyeFnName: ${var.namespaceName}-goodbye-fn
      e2eTestRunnerName: ${var.namespaceName}-e2e-test-runner
  - name: ci
    variables:
      namespaceName: ci-${slice(git.commitHash, 0, 7) || '<detached>'}
      helloFnName: ${var.namespaceName}-hello-fn
      goodByeFnName: ${var.namespaceName}-goodbye-fn
      e2eTestRunnerName: ${var.namespaceName}-e2e-test-runner
  - name: preview
    variables:
      namespaceName: preview-${git.branch}
      helloFnName: ${var.namespaceName}-hello-fn
      goodByeFnName: ${var.namespaceName}-goodbye-fn
      e2eTestRunnerName: ${var.namespaceName}-e2e-test-runner

providers:
  - name: terraform
    streamLogsToCloud: true
